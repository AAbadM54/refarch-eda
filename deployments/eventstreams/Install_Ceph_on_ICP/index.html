



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Ceph deployment on ICP - Event Driven Architecture</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#install-and-configure-ceph-for-ibm-cloud-private" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Event Driven Architecture" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Event Driven Architecture
            </span>
            <span class="md-header-nav__topic">
              Ceph deployment on ICP
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-eda/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Event Driven Architecture" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Event Driven Architecture
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-eda/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/" title="Reference diagrams" class="md-nav__link">
      Reference diagrams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../evt-src/" title="Event sources" class="md-nav__link">
      Event sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../evt-backbone/" title="Event backbone" class="md-nav__link">
      Event backbone
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../evt-action/" title="Event actions" class="md-nav__link">
      Event actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../evt-state/" title="Event managed states" class="md-nav__link">
      Event managed states
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/arch/" title="Event Stream & Kafka architecture" class="md-nav__link">
      Event Stream & Kafka architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Methodology
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Methodology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../methodology/readme/" title="Event Storming" class="md-nav__link">
      Event Storming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc/analysis/readme/" title="Event Storming applied to container shipment analysis" class="md-nav__link">
      Event Storming applied to container shipment analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../methodology/ddd/" title="Domain driven design" class="md-nav__link">
      Domain driven design
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Event driven patterns
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Event driven patterns
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../evt-microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../evt-microservices/ED-patterns/" title="Event-driven patterns" class="md-nav__link">
      Event-driven patterns
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/kafka-stream/" title="Kafka streaming processing" class="md-nav__link">
      Kafka streaming processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-data-ai-analytics/preparation/data-replication/" title="Data replication pattern" class="md-nav__link">
      Data replication pattern
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference implementations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Reference implementations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc" title="Container shipment implementation solution" class="md-nav__link">
      Container shipment implementation solution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Product guidances
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Product guidances
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/arch/" title="Kafka architecture" class="md-nav__link">
      Kafka architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/readme/" title="Kafka concepts summary" class="md-nav__link">
      Kafka concepts summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/producers/" title="Kafka producer development practices" class="md-nav__link">
      Kafka producer development practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/consumers/" title="Kafka consumer development practices" class="md-nav__link">
      Kafka consumer development practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/FAQ/" title="Kafka FAQ" class="md-nav__link">
      Kafka FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kafka/monitoring/" title="Kafka monitoring" class="md-nav__link">
      Kafka monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../serverless/" title="Serverless" class="md-nav__link">
      Serverless
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Deployments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Deployments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../es-ibm-cloud/" title="Event Streams IBM CLOUD deployment" class="md-nav__link">
      Event Streams IBM CLOUD deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Event Streams ICP deployment" class="md-nav__link">
      Event Streams ICP deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/" title="Kafka deployment" class="md-nav__link">
      Kafka deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../zookeeper/" title="Zookeeper deployment" class="md-nav__link">
      Zookeeper deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../postgresql/" title="Postgresql" class="md-nav__link">
      Postgresql
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Ceph deployment on ICP
      </label>
    
    <a href="./" title="Ceph deployment on ICP" class="md-nav__link md-nav__link--active">
      Ceph deployment on ICP
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment" title="Environment" class="md-nav__link">
    Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" title="Setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-download-the-required-setup-files" title="1. Download the required setup files" class="md-nav__link">
    1. Download the required setup files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-logon-to-ibm-cloud-private-cluster" title="2. Logon to IBM Cloud Private Cluster" class="md-nav__link">
    2. Logon to IBM Cloud Private Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-setup-ceph-cluster" title="3. Setup Ceph Cluster" class="md-nav__link">
    3. Setup Ceph Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-verify-ceph-cluster" title="4. Verify Ceph cluster" class="md-nav__link">
    4. Verify Ceph cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-troubleshooting-ceph-setup" title="5. Troubleshooting Ceph setup" class="md-nav__link">
    5. Troubleshooting Ceph setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-steps-for-reseting-an-used-disk" title="5.1 Steps for reseting an used disk" class="md-nav__link">
    5.1 Steps for reseting an used disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-steps-for-uninstalling-the-rook-ceph-setup" title="5.2 Steps for uninstalling the rook-ceph setup" class="md-nav__link">
    5.2 Steps for uninstalling the rook-ceph setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../strimzi/deploy/" title="Kafka deployment with Strimzi" class="md-nav__link">
      Kafka deployment with Strimzi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/ibm-cloud-architecture/refarch-integration/blob/master/docs/icp/troubleshooting.md" title="ICP troubleshouting" class="md-nav__link">
      ICP troubleshouting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../rt-analytics/" title="Real time analytics" class="md-nav__link">
      Real time analytics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../training/eda-skill-journey/" title="Skill journey" class="md-nav__link">
      Skill journey
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../compendium/" title="Compendium" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment" title="Environment" class="md-nav__link">
    Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" title="Setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-download-the-required-setup-files" title="1. Download the required setup files" class="md-nav__link">
    1. Download the required setup files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-logon-to-ibm-cloud-private-cluster" title="2. Logon to IBM Cloud Private Cluster" class="md-nav__link">
    2. Logon to IBM Cloud Private Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-setup-ceph-cluster" title="3. Setup Ceph Cluster" class="md-nav__link">
    3. Setup Ceph Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-verify-ceph-cluster" title="4. Verify Ceph cluster" class="md-nav__link">
    4. Verify Ceph cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-troubleshooting-ceph-setup" title="5. Troubleshooting Ceph setup" class="md-nav__link">
    5. Troubleshooting Ceph setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-steps-for-reseting-an-used-disk" title="5.1 Steps for reseting an used disk" class="md-nav__link">
    5.1 Steps for reseting an used disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-steps-for-uninstalling-the-rook-ceph-setup" title="5.2 Steps for uninstalling the rook-ceph setup" class="md-nav__link">
    5.2 Steps for uninstalling the rook-ceph setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-eda/edit/master/docs/deployments/eventstreams/Install_Ceph_on_ICP.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="install-and-configure-ceph-for-ibm-cloud-private">Install and configure Ceph for IBM Cloud Private</h1>
<p><a href="https://ceph.com/">Ceph</a> is open source software designed to provide highly scalable object, block and file-based storage under a unified system.</p>
<p>Ceph provides a POSIX-compliant network file system (CephFS) that aims for high performance, large data storage, and maximum compatibility with legacy applications.</p>
<p><a href="https://github.com/rook/rook">Rook</a> is an open source orchestrator for distributed storage systems running in cloud native environments.</p>
<p>Rook turns storage software into self-managing, self-scaling, and self-healing storage services. It does this by automating deployment, bootstrapping, configuration, provisioning, scaling, upgrading, migration, disaster recovery, monitoring, and resource management. Rook uses the facilities provided by the underlying cloud-native container management, scheduling and orchestration platform to perform its duties.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Helm chart <em>ibm-rook-rbd-cluster</em> is used for setting up Ceph Cluster in IBM Cloud Private.   </p>
</div>
<h2 id="environment">Environment</h2>
<p>A typical IBM Cloud Private Environment includes Boot node, Master node, Management node, Proxy node and Worker nodes. When the Ceph RBD Cluster is used for providing storage for API Connect, any three worker nodes should be configured to have additional raw disks.</p>
<p>The following set of systems can be used as reference for building <em>development (non-HA) environment</em> that runs IBM API Connect workload on IBM Cloud Private.</p>
<table>
<thead>
<tr>
<th align="center">Node type</th>
<th align="center">Number of nodes</th>
<th align="center">CPU</th>
<th align="center">Memory (GB)</th>
<th align="center">Disk (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Boot (FTP Server)</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">2048</td>
</tr>
<tr>
<td align="center">Master</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">300</td>
</tr>
<tr>
<td align="center">Management</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">300</td>
</tr>
<tr>
<td align="center">Proxy</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">16</td>
<td align="center">300</td>
</tr>
<tr>
<td align="center">Worker</td>
<td align="center">3</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">300+500(disk2)</td>
</tr>
<tr>
<td align="center">Total</td>
<td align="center">7</td>
<td align="center">52</td>
<td align="center">208</td>
<td align="center">3848+1500(disk2)</td>
</tr>
</tbody>
</table>
<p>The following set of systems can be used as reference for building <em>production (HA) environment</em> that runs IBM API Connect workload on IBM Cloud Private.</p>
<table>
<thead>
<tr>
<th align="center">Node type</th>
<th align="center">Number of nodes</th>
<th align="center">CPU</th>
<th align="center">Memory (GB)</th>
<th align="center">Disk (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Boot (FTP Server)</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">2048</td>
</tr>
<tr>
<td align="center">Master</td>
<td align="center">3</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">300</td>
</tr>
<tr>
<td align="center">Management</td>
<td align="center">2</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">300</td>
</tr>
<tr>
<td align="center">Proxy</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">16</td>
<td align="center">300</td>
</tr>
<tr>
<td align="center">Worker</td>
<td align="center">3</td>
<td align="center">16</td>
<td align="center">64</td>
<td align="center">300+750(disk2)</td>
</tr>
<tr>
<td align="center">Total</td>
<td align="center">12</td>
<td align="center">108</td>
<td align="center">432</td>
<td align="center">5348+2250(disk2)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Additional worker nodes will be required when there is a a need to run workloads other than IBM API Connect on IBM Cloud Private.</p>
</div>
<h2 id="setup">Setup</h2>
<p>This document covers the setup of <em>Ceph</em> storage using <em>Rook</em>.</p>
<p>The following tasks are performed for setting up the Ceph Cluster. </p>
<ol>
<li><a href="#1-download-the-required-setup-files">Download the required setup files</a></li>
<li><a href="#2-logon-to-ibm-cloud-private-cluster">Logon to IBM Cloud Private Cluster</a></li>
<li><a href="#3-setup-ceph-cluster">Setup Ceph Cluster</a></li>
<li><a href="#4-verify-ceph-cluster">Verify Ceph cluster</a></li>
<li><a href="#5-troubleshooting-ceph-setup">Troubleshooting Ceph setup</a></li>
</ol>
<h3 id="1-download-the-required-setup-files">1. Download the required setup files</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following files are required for installing <em>ibm-rook-rbd-cluster</em> chart and setting up Ceph cluster</p>
</div>
<ul>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/scripts/icp/login.sh">login.sh</a> - Utility for logging onto IBM Cloud Private</li>
<li><a href="https://raw.githubusercontent.com/IBM/charts/master/repo/stable/ibm-rook-rbd-cluster-0.8.3.tgz">ibm-rook-rbd-cluster-0.8.3.tgz</a> - IBM Chart for Rook RBD Cluster</li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/ceph-values.yaml">ceph-values.yaml</a> - Sample values.yaml for installing Ceph Cluster </li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/rook-ceph-cluster-role-binding.yaml">rook-ceph-cluster-role-binding.yaml</a> - ClusterRoleBinding for the service account rook-ceph-cluster</li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/rook-ceph-operator-values.yaml">rook-ceph-operator-values.yaml</a> - Sample values.yaml for installing rook operator</li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/rook-cluster-role.yaml">rook-cluster-role.yaml</a> - ClusterRole for the resource rook-privileged</li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/rook-pod-security-policy.yaml">rook-pod-security-policy.yaml</a> - Define PodSecurityPolicy rook-privileged</li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/setup.sh">setup.sh</a> - Utility for setting up Ceph Cluster </li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/status.sh">status.sh</a> - Utility for verifying Ceph Cluster </li>
<li><a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/cleanup.sh">cleanup.sh</a> - Utility for cleaning up Ceph Cluster </li>
</ul>
<h3 id="2-logon-to-ibm-cloud-private-cluster">2. Logon to IBM Cloud Private Cluster</h3>
<p>The script <a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/scripts/icp/login.sh">login.sh</a> can be run to login to IBM Cloud Private Cluster. </p>
<p>!! note
    The script should be updated to include the correct value for <em>CLUSTER_NAME</em>.</p>
<p>Sample run of the login script is as follows: </p>
<p><img alt="" src="../images/loginToDefaultNamespace.png" /></p>
<h3 id="3-setup-ceph-cluster">3. Setup Ceph Cluster</h3>
<p><strong>Step #1</strong> Update the <a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/ceph-values.yaml">ceph-values.yaml</a> to match your environment.</p>
<p>The file <em>ceph-values.yaml</em> needs to be updated to list the IP address of the storage node within the IBM Cloud Private cluster. </p>
<div class="codehilite"><pre><span></span>...
#
# UPDATE VARIABLES TO MATCH THE ENVIRONMENT
#   
    nodes:
    - name: &quot;X.X.X.X&quot;
      devices:
      - name: &quot;DISK_NAME&quot;
    - name: &quot;Y.Y.Y.Y&quot;
      devices:
      - name: &quot;DISK_NAME&quot;
    - name: &quot;Z.Z.Z.Z&quot;
      devices:
      - name: &quot;DISK_NAME&quot;
...
...
</pre></div>

<p><strong>Step #2</strong> Modify and run the setup script to install Rook Operator chart and the IBM Rook RBD Cluster chart</p>
<p>The contents of the script <a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/setup.sh">setup.sh</a> is as follows: </p>
<div class="codehilite"><pre><span></span>#
# UPDATE VARIABLES TO MATCH THE ENVIRONMENT
#

# Define the location of images 
IMAGE_DIR=/DIRECTORY_HAVING_IMAGES

...
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The script should be updated to include the correct location for <em>IMAGE_DIR</em> that has the location where the chart ibm-rook-rbd-cluster-0.8.3.tgz is downloaded and unzipped. </p>
</div>
<p>The output of Ceph install is listed below for reference: </p>
<ul>
<li><a href="../samples/ceph_install.log">ceph_install.log</a></li>
</ul>
<h3 id="4-verify-ceph-cluster">4. Verify Ceph cluster</h3>
<p>The script <a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/status.sh">status.sh</a> can be run to check if Ceph cluster is working as expected. </p>
<p>The contents of the script <a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/status.sh">status.sh</a> is as follows: </p>
<div class="codehilite"><pre><span></span>./deployments/ceph/status.sh 
</pre></div>

<p>Expected output is listed below. </p>
<p><img alt="" src="../images/cephGetStatus.png" /></p>
<h3 id="5-troubleshooting-ceph-setup">5. Troubleshooting Ceph setup</h3>
<h4 id="51-steps-for-reseting-an-used-disk">5.1 Steps for reseting an used disk</h4>
<p>It is possible that sometimes OSD pods does't start up even though the OSD prepare jobs have completed successfully. 
It could happen when the device you have specified does not have a raw disk and the device name you have listed was used for other storage like GlusterFS cluster.</p>
<p>In such case the following commands can be run to collect the Logical Volume group ID and Physical volume and remove it fully so that the raw disk is made available for the Ceph cluster.</p>
<div class="codehilite"><pre><span></span>pvs
pvdisplay
vgremove LOGIOCAL_VOLUME_GROUP_ID -y 
pvremove PHYSICAL_VOLUME
</pre></div>

<p>The output of the aforesaid commands is listed below.</p>
<div class="codehilite"><pre><span></span>[root@rsun-rhel-glusterfs03 ~]# pvs
  PV         VG                                  Fmt  Attr PSize   PFree  
  /dev/sda2  rhel                                lvm2 a--   39.00g      0 
  /dev/sdb   vg_687894352b254c630b291bf094a8d43d lvm2 a--  499.87g 499.87g
  /dev/sdc   rhel                                lvm2 a--  500.00g      0 
[root@rsun-rhel-glusterfs03 ~]# pvdisplay
  --- Physical volume ---
  PV Name               /dev/sdb
  VG Name               vg_687894352b254c630b291bf094a8d43d
  PV Size               500.00 GiB / not usable 132.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              127967
  Free PE               127967
  Allocated PE          0
  PV UUID               v6xOuh-M2ot-oXfl-IWyf-TnYL-nX3a-kzqizN

  --- Physical volume ---
  PV Name               /dev/sda2
  VG Name               rhel
  PV Size               39.00 GiB / not usable 3.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              9983
  Free PE               0
  Allocated PE          9983
  PV UUID               tNjUif-RlBT-kdDn-PWwE-LHlq-3w9O-65Hlph

  --- Physical volume ---
  PV Name               /dev/sdc
  VG Name               rhel
  PV Size               500.00 GiB / not usable 4.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              127999
  Free PE               0
  Allocated PE          127999
  PV UUID               7CXpz5-95hb-0WAC-3Efe-XrY1-s6E6-dqLasC

[root@rsun-rhel-glusterfs03 ~]# vgremove vg_687894352b254c630b291bf094a8d43d -y 
  Volume group &quot;vg_687894352b254c630b291bf094a8d43d&quot; successfully removed
[root@rsun-rhel-glusterfs03 ~]# pvremove /dev/sdb 
  Labels on physical volume &quot;/dev/sdb&quot; successfully wiped.
</pre></div>

<h4 id="52-steps-for-uninstalling-the-rook-ceph-setup">5.2 Steps for uninstalling the rook-ceph setup</h4>
<p><strong>Step #1</strong> The script <a href="https://github.com/ibm-cloud-architecture/refarch-eda/blob/master/deployments/ceph/cleanup.sh">cleanup.sh</a> can be run to remove the Ceph setup completely.</p>
<div class="codehilite"><pre><span></span>./deployments/ceph/cleanup.sh
</pre></div>

<p><strong>Step #2</strong> Remove the contents of the temporary directory used by rook: <em>/var/lib/rook</em></p>
<p>The following command should run on all the worker nodes: </p>
<div class="codehilite"><pre><span></span>rm -fr /var/lib/rook
</pre></div>

<h1 id="ceph-cluster-management">Ceph Cluster Management</h1>
<p>The following links has additional details on how to diagnose, troubleshoot, monitor and report Ceph cluster storage: </p>
<ul>
<li><a href="https://github.com/rook/rook/tree/master/Documentation">https://github.com/rook/rook/tree/master/Documentation</a></li>
<li><a href="https://github.com/rook/rook/blob/master/Documentation/common-issues.md#troubleshooting-techniques">https://github.com/rook/rook/blob/master/Documentation/common-issues.md#troubleshooting-techniques</a></li>
<li><a href="https://sysdig.com/blog/monitor-ceph-top-5-metrics-watch/">https://sysdig.com/blog/monitor-ceph-top-5-metrics-watch/</a></li>
<li><a href="https://tracker.ceph.com/projects/ceph/wiki/10_Commands_Every_Ceph_Administrator_Should_Know">https://tracker.ceph.com/projects/ceph/wiki/10_Commands_Every_Ceph_Administrator_Should_Know</a></li>
<li><a href="https://sabaini.at/pages/ceph-cheatsheet.html">https://sabaini.at/pages/ceph-cheatsheet.html</a></li>
</ul>
<p>The <em>Ceph Monitor</em> pod can be attached using the following command:</p>
<div class="codehilite"><pre><span></span>kubectl -n rook-ceph exec -it $(kubectl -n rook-ceph get pod -l &quot;app=rook-ceph-mon&quot; -o jsonpath=&#39;{.items[0].metadata.name}&#39;) bash
</pre></div>

<p>After being attached to the <em>Ceph Monitor</em> pod, the following commands can be run which provides status and statistics of the <em>Ceph Cluster</em>.</p>
<div class="codehilite"><pre><span></span>ceph health 
ceph status 
ceph df 
ceph osd stat
ceph osd tree
ceph osd df 
ceph osd df tree
ceph osd perf 
ceph osd pool stats
ceph osd status 
ceph osd utilization
ceph auth list 
ceph quorum_status
ceph mon_status
ceph mon dump 
ceph pg dump 
ceph pg stat
</pre></div>

<p>The following link has details on how to add and remove Ceph storage: </p>
<ul>
<li><a href="https://github.com/rook/rook/blob/master/design/cluster-update.md">https://github.com/rook/rook/blob/master/design/cluster-update.md</a></li>
</ul>
<p>The following link can be used as reference for backing up and restoring the images stored in the Ceph Pool. </p>
<ul>
<li><a href="https://nicksabine.com/post/ceph-backup/">https://nicksabine.com/post/ceph-backup/</a></li>
</ul>
<p>Related commands are: </p>
<div class="codehilite"><pre><span></span><span class="n">rbd</span> <span class="n">ls</span> <span class="o">-</span><span class="n">p</span> <span class="n">replicapool</span>
<span class="n">rbd</span> <span class="n">export</span> 
<span class="n">rbd</span> <span class="kn">import</span> 
</pre></div>

<p>The aforesaid commands can be run after being attached to the Ceph Monitor pod. </p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../postgresql/" title="Postgresql" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Postgresql
              </span>
            </div>
          </a>
        
        
          <a href="../../strimzi/deploy/" title="Kafka deployment with Strimzi" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Kafka deployment with Strimzi
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>