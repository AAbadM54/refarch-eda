



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Kafka deployment - Event Driven Architecture</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#kafka-deployment" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Event Driven Architecture" class="md-header-nav__button md-logo">
          
            <img src="../../images/cloud.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Event Driven Architecture
            </span>
            <span class="md-header-nav__topic">
              Kafka deployment
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-eda/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Event Driven Architecture" class="md-nav__button md-logo">
      
        <img src="../../images/cloud.png" width="48" height="48">
      
    </a>
    Event Driven Architecture
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-eda/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../architecture/" title="Reference diagrams" class="md-nav__link">
      Reference diagrams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evt-src/" title="Event sources" class="md-nav__link">
      Event sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evt-backbone/" title="Event backbone" class="md-nav__link">
      Event backbone
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evt-action/" title="Event actions" class="md-nav__link">
      Event actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evt-state/" title="Event managed states" class="md-nav__link">
      Event managed states
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/arch/" title="Event Stream & Kafka architecture" class="md-nav__link">
      Event Stream & Kafka architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Methodology
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Methodology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../methodology/readme/" title="Event driven methodology" class="md-nav__link">
      Event driven methodology
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../methodology/eventstorming/" title="Event Storming" class="md-nav__link">
      Event Storming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc/analysis/readme/" title="Event Storming applied to container shipment analysis" class="md-nav__link">
      Event Storming applied to container shipment analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../methodology/ddd/" title="Domain driven design for event based solution" class="md-nav__link">
      Domain driven design for event based solution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Event driven design patterns
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Event driven design patterns
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../evt-microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../design-patterns/ED-patterns/" title="Event-driven patterns" class="md-nav__link">
      Event-driven patterns
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../design-patterns/event-sourcing/" title="Event Sourcing" class="md-nav__link">
      Event Sourcing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../design-patterns/cqrs/" title="CQRS" class="md-nav__link">
      CQRS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../design-patterns/saga/" title="Saga" class="md-nav__link">
      Saga
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/kafka-stream/" title="Kafka streaming processing" class="md-nav__link">
      Kafka streaming processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-data-ai-analytics/preparation/data-replication/" title="Data replication pattern" class="md-nav__link">
      Data replication pattern
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference implementations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Reference implementations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc" title="Container shipment implementation solution" class="md-nav__link">
      Container shipment implementation solution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Product guidances
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Product guidances
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/arch/" title="Kafka architecture" class="md-nav__link">
      Kafka architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/readme/" title="Kafka concepts summary" class="md-nav__link">
      Kafka concepts summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/producers/" title="Kafka producer development practices" class="md-nav__link">
      Kafka producer development practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/consumers/" title="Kafka consumer development practices" class="md-nav__link">
      Kafka consumer development practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/FAQ/" title="Kafka FAQ" class="md-nav__link">
      Kafka FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kafka/monitoring/" title="Kafka monitoring" class="md-nav__link">
      Kafka monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/" title="Serverless" class="md-nav__link">
      Serverless
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Deployments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Deployments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eventstreams/es-ibm-cloud/" title="Event Streams IBM CLOUD deployment" class="md-nav__link">
      Event Streams IBM CLOUD deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../eventstreams/" title="Event Streams ICP deployment" class="md-nav__link">
      Event Streams ICP deployment
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kafka deployment
      </label>
    
    <a href="./" title="Kafka deployment" class="md-nav__link md-nav__link--active">
      Kafka deployment
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#development" title="Development" class="md-nav__link">
    Development
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verifying-kafka-is-connected-to-zookeeper" title="Verifying Kafka is connected to zookeeper" class="md-nav__link">
    Verifying Kafka is connected to zookeeper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-pubsub-works-with-text-messages" title="Verifying pub/sub works with text messages" class="md-nav__link">
    Verifying pub/sub works with text messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-kafka-in-docker-on-linux" title="Run Kafka in Docker On Linux" class="md-nav__link">
    Run Kafka in Docker On Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-considerations" title="Deployment considerations" class="md-nav__link">
    Deployment considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verifying-deployment" title="Verifying deployment" class="md-nav__link">
    Verifying deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assess-the-list-of-topics" title="Assess the list of Topics" class="md-nav__link">
    Assess the list of Topics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout-while-sending-message-to-topic" title="Timeout while sending message to topic" class="md-nav__link">
    Timeout while sending message to topic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zookeeper/" title="Zookeeper deployment" class="md-nav__link">
      Zookeeper deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../postgresql/" title="Postgresql" class="md-nav__link">
      Postgresql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../eventstreams/Install_Ceph_on_ICP/" title="Ceph deployment on ICP" class="md-nav__link">
      Ceph deployment on ICP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../strimzi/deploy/" title="Kafka deployment with Strimzi" class="md-nav__link">
      Kafka deployment with Strimzi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/ibm-cloud-architecture/refarch-integration/blob/master/docs/icp/troubleshooting.md" title="ICP troubleshouting" class="md-nav__link">
      ICP troubleshouting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Real time analytics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Real time analytics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../rt-analytics/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-reefer-ml" title="Reefer Container Predictive Maintenance" class="md-nav__link">
      Reefer Container Predictive Maintenance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../training/eda-skill-journey/" title="Skill journey" class="md-nav__link">
      Skill journey
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../compendium/" title="Compendium" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#development" title="Development" class="md-nav__link">
    Development
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verifying-kafka-is-connected-to-zookeeper" title="Verifying Kafka is connected to zookeeper" class="md-nav__link">
    Verifying Kafka is connected to zookeeper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-pubsub-works-with-text-messages" title="Verifying pub/sub works with text messages" class="md-nav__link">
    Verifying pub/sub works with text messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-kafka-in-docker-on-linux" title="Run Kafka in Docker On Linux" class="md-nav__link">
    Run Kafka in Docker On Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-considerations" title="Deployment considerations" class="md-nav__link">
    Deployment considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verifying-deployment" title="Verifying deployment" class="md-nav__link">
    Verifying deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assess-the-list-of-topics" title="Assess the list of Topics" class="md-nav__link">
    Assess the list of Topics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout-while-sending-message-to-topic" title="Timeout while sending message to topic" class="md-nav__link">
    Timeout while sending message to topic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-eda/edit/master/docs/deployments/kafka/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="kafka-deployment">Kafka Deployment</h1>
<p>We are proposing different deployment approaches:</p>
<ul>
<li>Using IBM Event Streams on kubernetes or Openshift (See <a href="../eventstreams/">separate note</a>)</li>
<li>Using Kafka on development environment, mostly developer workstation</li>
<li>Using IBM Event Streams as service in IBM Cloud. (See <a href="../eventstreams/es-ibm-cloud/">this note</a>)</li>
</ul>
<p>We are defining two types of manifests, one set for development environment and one for production. The manifests and scripts are under each deployment folders.</p>
<h2 id="development">Development</h2>
<p>For kafka the manifests are in this project under the <code>deployments/kafka/dev</code> folder. We are using the google image: <code>bitnami/kafka</code>.</p>
<p>We tested on MacOS with Docker Edge and Kubernetes.</p>
<p>We are also providing scripts to deploy Kafka to a kubernetes cluster:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">pwd</span>
&gt; deployments/kafka
$ ./deployKafka.sh
$ kubectl get pods -n greencompute
NAME                            READY     STATUS    RESTARTS   AGE
gc-kafka-0                      <span class="m">1</span>/1       Running   <span class="m">0</span>          2m
gc-zookeeper-57dc5679bb-bh29q   <span class="m">1</span>/1       Running   <span class="m">0</span>          10m
</pre></div>

<h3 id="verifying-kafka-is-connected-to-zookeeper">Verifying Kafka is connected to zookeeper</h3>
<p>The goal is to connect to the kafka running container and use the scripts inside kafka bin folder:</p>
<div class="codehilite"><pre><span></span><span class="c1"># connect to the running container:</span>
$ kubectl <span class="nb">exec</span>  -ti gc-kafka-0 /bin/bash -n greencompute
<span class="c1"># next is the prompt inside the container:</span>
kafka@gc-kafka-0:/$ <span class="nb">cd</span> /opt/kafka/bin
<span class="c1"># for example create a topic for testing</span>
kafka@gc-kafka-0:/$./kafka-topics.sh --create  --zookeeper gc-client-zookeeper-svc.greencompute.svc.cluster.local:2181 --replication-factor <span class="m">1</span> --partitions <span class="m">1</span> --topic text-topic
</pre></div>

<p>This previous command create a <code>text-topic</code> and to verify the configured existing topics use the command (inside the container):</p>
<div class="codehilite"><pre><span></span>kafka@gc-kafka-0:/$./kafka-topics.sh --list --zookeeper gc-client-zookeeper-svc.greencompute.svc.cluster.local:2181
</pre></div>

<p>The URL of the zookeeper matches the hostname defined when deploying zookeeper service (see <a href="../zookeeper/">installing zookeeper note</a> ):</p>
<div class="codehilite"><pre><span></span>kubectl describe svc gc-client-zookeeper-svc
</pre></div>

<h3 id="verifying-pubsub-works-with-text-messages">Verifying pub/sub works with text messages</h3>
<p>Two scripts exist in the <code>scripts</code> folder in this repository. Those scripts are using <a href="https://docs.confluent.io/current/app-development/kafkacat-usage.html">kafkacat</a> tool from Confluent. You need to add the following in your hostname resolution configuration (DNS or /etc/hosts), matching you IP address of your laptop.</p>
<div class="codehilite"><pre><span></span><span class="m">192</span>.168.1.89 gc-kafka-0.gc-kafka-hl-svc.greencompute.svc.cluster.local
</pre></div>

<p>Start the consumer in a terminal window</p>
<div class="codehilite"><pre><span></span>./scripts/kafka/consumetext.sh
</pre></div>

<p>And start the producer in a second terminal:</p>
<div class="codehilite"><pre><span></span>./scripts/kafka/producetext.sh
</pre></div>

<p>You should see the text:</p>
<div class="codehilite"><pre><span></span>try to send some text
to the text-topic
Let see...
% Reached end of topic text-topic <span class="o">[</span><span class="m">0</span><span class="o">]</span> at offset <span class="m">3</span>
</pre></div>

<h3 id="run-kafka-in-docker-on-linux">Run Kafka in Docker On Linux</h3>
<p>If you run on a linux operating system, you can use the <a href="https://hub.docker.com/r/spotify/kafka/">Spotify <strong>Kafka</strong> image</a> from dockerhub as it includes Zookeeper and <strong>Kafka</strong> in a single image.</p>
<p>It is started in background (-d), named "<strong>Kafka</strong>" and mounting scripts folder to /scripts:</p>
<div class="codehilite"><pre><span></span>docker run -d -p <span class="m">2181</span>:2181 -p <span class="m">9092</span>:9092 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:/scripts --env <span class="nv">ADVERTISED_HOST</span><span class="o">=</span><span class="sb">`</span>docker-machine ip <span class="se">\`</span>docker-machine active<span class="se">\`</span><span class="sb">`</span> --name kafka --env <span class="nv">ADVERTISED_PORT</span><span class="o">=</span><span class="m">9092</span> spotify/kafka
</pre></div>

<p>Then remote connect to the docker container to open a bash shell:</p>
<div class="codehilite"><pre><span></span>docker <span class="nb">exec</span>  -ti kafka/bin/bash
</pre></div>

<p>Create a topic: it uses zookeeper as a backend to persist partition within the topic. In this deployment zookeeper and <strong>Kafka</strong> are running on the localhost inside the container. So port 2181 is the client port for zookeeper.</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /opt/kafka/bin
./kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor <span class="m">1</span> --partitions <span class="m">1</span> --topic mytopic
./kafka-topics.sh --list --zookeeper localhost:2181
</pre></div>

<p>We have done shell scripts for you to do those command and test your local <strong>Kafka</strong>. The scripts are under <code>../scripts/kafka</code></p>
<ul>
<li>createtopic.sh</li>
<li>listtopic.sh</li>
<li>sendText.sh  Send a multiple lines message on mytopic topic- open this one in one terminal.</li>
<li>consumeMessage.sh  Connect to the topic to get messages. and this second in another terminal.</li>
</ul>
<h3 id="deployment-considerations">Deployment considerations</h3>
<p>One major requirement to address which impacts kubernetes Kafka Services configuration and Kafka Broker server configuration is to assess remote access need: do we need to have applications not deployed on Kubernetes that will publish and/or consume message to/from topics defined in the Kafka Brokers running in pods. Normally the answer should be yes as all deployments are hybrid cloud per nature.
As the current client API is doing its own load balancing between brokers we will not be able to use ingress or dynamic node port allocation.</p>
<p>Let explain by starting to review Java code to access brokers. The properties needed to access is BOOTSTRAP_SERVERS:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">BOOTSTRAP_SERVERS</span> <span class="o">=</span> <span class="s">&quot;172.16.40.133:32224,172.16.40.137:32224,172.16.40.135:32224&quot;</span><span class="o">;</span>
<span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
<span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ProducerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="n">BOOTSTRAP_SERVERS</span><span class="o">);</span>
<span class="n">kafkaProducer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KafkaProducer</span><span class="o">&lt;&gt;(</span><span class="n">properties</span><span class="o">);</span>
<span class="o">....</span>
</pre></div>

<p>To connect to broker  their addresses and port numbers need to be specified. This information should come from external properties file (the code above is for illustration). The problem is that once deployed in Kubernetes,  Kafka broker runs as pod so have dynamic port numbers if we expose a service using NodePort, the IP address may change overtime while pod are scheduled to Node. The list of brokers need to be in the format: <host>:<port>, <host>:<port>,<host>:<port>. A host list, without port number will not work, forbidden the use of virtual host name defined with Ingress manifest and managed by Kubernetes ingress proxy. An external load balancer will not work too.
Here is an example of return message when the broker list is not set right: <code>Connection to node -1 could not be established. Broker may not be available</code>.</p>
<p>There are two options to support remote connection: implement a proxy, deployed inside the Kubernetes cluster, with 3 or 5 hostnames and port to expose the brokers, or use static NodePort. As of now for development we used NodePort:</p>
<div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gc-kafka</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gc-kafka-svc</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="nt">ports</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kafka-port</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32224</span>
    <span class="nt">nodePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32224</span>
    <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32224</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gc-kafka</span>
</pre></div>

<p>So we use a port number for internal and external communication. In statefulset we use a google created tool to start the kafka server and set parameters to override the default the <code>conf/server.properties</code>.</p>
<div class="codehilite"><pre><span></span>command:
- <span class="s2">&quot;exec kafka-server-start.sh /opt/kafka/config/server.properties --override broker.id=</span><span class="si">${</span><span class="nv">HOSTNAME</span><span class="p">##*-</span><span class="si">}</span><span class="s2"> \</span>
<span class="s2">  --override listeners=PLAINTEXT://:32224 \</span>
</pre></div>

<p>When consumer or producer connect to a broker in the list there are some messages exchanged, like getting the cluster ID and the endpoint to be used which corresponds to a virtual DNS name of the exposed service:
<code>gc-kafka-0.gc-kafka-hl-svc.greencompute.svc.cluster.local</code>:</p>
<div class="codehilite"><pre><span></span>INFO  org.apache.kafka.clients.Metadata - Cluster ID: 4qlnD1e-S8ONpOkIOGE8mg
INFO  o.a.k.c.c.i.AbstractCoordinator - <span class="o">[</span>Consumer <span class="nv">clientId</span><span class="o">=</span>consumer-1, <span class="nv">groupId</span><span class="o">=</span>b6e69280-aa7f-47d2-95f5-f69a8f86b967<span class="o">]</span> Discovered group coordinator gc-kafka-0.gc-kafka-hl-svc.greencompute.svc.cluster.local:32224 <span class="o">(</span>id: <span class="m">2147483647</span> rack: null<span class="o">)</span>
</pre></div>

<p>So the code may not have this entry defined in the DNS. I used /etc/hosts to map it to K8s Proxy IP address. Also the port number return is the one specified in the server configuration, it has to be one Kubernetes and Calico set in the accepted range and exposed on each host of the cluster. With that connection can be established.</p>
<h4 id="verifying-deployment">Verifying deployment</h4>
<p>We can use the tools delivered with Kafka by using the very helpful <code>kubectl exec</code> command.</p>
<ul>
<li>Validate the list of topics from the developer's workstation using the command:</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> -ti gc-Kafka-0 -- bash -c <span class="s2">&quot;kafka-topics.sh --list --zookeeper gc-srv-zookeeper-svc.greencompute.svc.cluster.local:2181 &quot;</span>

or
Kafka-topics.sh --describe --topic text-topic --zookeeper gc-srv-zookeeper-svc.greencompute.svc.cluster.local:2181
</pre></div>

<ul>
<li>start the consumer from the developer's workstation</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get pods <span class="p">|</span> grep gc-Kafka
kubectl <span class="nb">exec</span> gc-Kafka-0 -- bash -c <span class="s2">&quot;Kafka-console-consumer.sh --bootstrap-server  localhost:9093 --topic test-topic --from-beginning&quot;</span>
</pre></div>

<p>the script <code>deployment/Kafka/consumetext.sh</code> executes those commands. As we run in the Kafka broker the host is localhost and the port number is the headless service one.</p>
<ul>
<li>start a text producer</li>
</ul>
<p>Using the same approach we can use broker tool:
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> gc-Kafka-0 -- bash -c <span class="s2">&quot;/opt/Kafka/bin/Kafka-console-producer.sh --broker-list localhost:9093 --topic test-topic &lt;&lt; EOB</span>
<span class="s2">this is a message for you and this one too but this one...</span>
<span class="s2">I m not sure</span>
<span class="s2">EOB&quot;</span>
</pre></div></p>
<p>Next steps... do pub/sub message using remote IP and port from remote server. The code is in <a href="">this project</a>.</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>For ICP troubleshooting see this centralized <a href="https://github.com/ibm-cloud-architecture/refarch-integration/blob/master/docs/icp/troubleshooting.md">note</a></p>
<h4 id="assess-the-list-of-topics">Assess the list of Topics</h4>
<div class="codehilite"><pre><span></span><span class="c1"># remote connect to the Kafka pod and open a bash:</span>
kubectl <span class="nb">exec</span> -ti Kafka-786975b994-9m8n2 bash
bash-4.4# ./Kafka-topics.sh  --zookeeper <span class="m">192</span>.168.1.89:30181 --list
</pre></div>

<p>Purge a topic with bad message: delete and recreate it</p>
<div class="codehilite"><pre><span></span>./Kafka-topics.sh  --zookeeper <span class="m">192</span>.168.1.89:30181 --delete --topic test-topic
./Kafka-topics.sh  --zookeeper <span class="m">192</span>.168.1.89:30181 --create --replication-factor <span class="m">1</span> --partitions <span class="m">1</span> --topic test-topic
</pre></div>

<h4 id="timeout-while-sending-message-to-topic">Timeout while sending message to topic</h4>
<p>The error message may look like:</p>
<div class="codehilite"><pre><span></span>Error when sending message to topic test-topic with key: null, value: <span class="m">12</span> bytes with error: <span class="o">(</span>org.apache.Kafka.clients.producer.internals.ErrorLoggingCallback<span class="o">)</span>
org.apache.Kafka.common.errors.TimeoutException: Failed to update metadata after <span class="m">60000</span> ms.
</pre></div>

<p>This can be linked to a lot of different issues, but it is a communication problem. Assess the following:</p>
<ul>
<li>port number exposed match the broker's one.</li>
<li>host name known by the server running the producer or consumer code.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../eventstreams/" title="Event Streams ICP deployment" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Event Streams ICP deployment
              </span>
            </div>
          </a>
        
        
          <a href="../zookeeper/" title="Zookeeper deployment" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Zookeeper deployment
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>